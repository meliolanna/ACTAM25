<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Games - BEAT THE BEAT</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="top-right-toolbar">
    <button id="settingsBtn" class="mini-btn">
        <img src="icons/settings-1.png" class="btn-icon" alt="Settings">
    </button>
    
    <button onclick="openLeaderboard()" id="leaderBtn" class="mini-btn">
        <img src="icons/trophy-1.png" class="btn-icon" alt="LeaderBoard">
    </button>

    <button id="infoBtn" class="mini-btn">
        <img src="icons/question-1.png" class="btn-icon" alt="Info">
    </button>
  </div>

  <div class="top-left-toolbar">
    <a href="index.html" class="sound-link">
      <button class="mini-btn">
        <img src="icons/home-1.png" class="btn-icon" alt="Home">
      </button>
    </a>
  </div>

  <h1 class="main-title">Let's play!</h1>

  <a id="playAllBtn" class="sound-link">
    <button class="pulsante">PLAY ALL THE GAMES</button>
  </a>

  <img class="pixel-art" src="gif/pugile.gif" alt="Boxer">

  <h1 class="subtitle">or practice a single mode:</h1>

  <div class="button-container">
    <a id="mg1Btn" class="sound-link">
      <button class="pulsante pulsante--verde">1. Follow the beat</button>
    </a>

    <a id="mg2Btn" class="sound-link">
      <button class="pulsante">2. Listen and repeat</button>
    </a>

    <a id="mg3Btn" class="sound-link">
      <button class="pulsante pulsante--viola">3. Read the rhythm</button>
    </a>
  </div>

  <div id="leaderboardModal" class="modal modal--hidden">
    <div class="modal-content">
      <h2 class="modal-title">LEADERBOARD üèÜ</h2>
      <div id="leaderboardList">Loading...</div>
      <div class="modal-button-row">
        <button id="closeLeaderboardBtn" class="start-btn start-btn--back">CLOSE</button>
      </div>
    </div>
  </div>

  <div id="infoModal" class="modal modal--hidden">
    <div class="modal-content">
      <h2 class="modal-title">THE BEATERS</h2>
      <p>Any suggestion?</p>
      <a href="https://github.com/meliolanna" target="_blank">
        <button class="start-btn">CONTACT US</button>
      </a>
      <div class="modal-button-row">
        <button id="closeInfoBtn" class="start-btn start-btn--back">CLOSE</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { initLeaderboard } from "./leaderboardUI.js";
    import { initSettings } from "./settingsUI.js";
    import { initInfo } from "./infoUI.js";
    import { AudioManager } from './GameSounds.js';

    // 1. GESTIONE PARAMETRI URL E LINK DINAMICI )
    const params = new URLSearchParams(window.location.search);
    const difficulty = params.get("difficulty") || "medium";

    // Imposta gli href dinamici in base alla difficolt√†
    document.getElementById("playAllBtn").href = `44.html?difficulty=${difficulty}&mode=all`;
    document.getElementById("mg1Btn").href = `44.html?difficulty=${difficulty}&mode=mg1`;
    document.getElementById("mg2Btn").href = `44.html?difficulty=${difficulty}&mode=mg2`;
    document.getElementById("mg3Btn").href = `44.html?difficulty=${difficulty}&mode=mg3`;

    
    initLeaderboard();
    initSettings();
    initInfo();

    // 2. GESTIONE AUDIO 
    window.addEventListener('load', () => {
        const audio = new AudioManager();
        audio.init(); 

        
        const unlockAudio = () => {
            if (!audio.ctx) audio.init();
            else if (audio.ctx.state === 'suspended') audio.ctx.resume();
        };

        // A. PULSANTI SEMPLICI (Toolbar, Modali)
        
        const simpleButtons = document.querySelectorAll('.mini-btn, .start-btn');

        simpleButtons.forEach(btn => {
            
            if (btn.closest('.sound-link')) return;

            btn.addEventListener('click', () => {
                unlockAudio();
                audio.playTouchUI();
            });
        });

        // B. LINK DI NAVIGAZIONE (Giochi, Back button)
        
        const navLinks = document.querySelectorAll('.sound-link');

        navLinks.forEach(link => {
            link.addEventListener('click', (event) => {
               
                event.preventDefault();

               
                unlockAudio();
                audio.playTouchUI();

                
                const targetUrl = link.getAttribute('href');

                
                if (targetUrl) {
                    setTimeout(() => {
                        window.location.href = targetUrl;
                    }, 300);
                }
            });
        });
    });
  </script>

</body>
</html>