<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4/4 Rhythm game</title>
    <link rel="stylesheet" href="style.css">
  </head>

  <body class="pagina-viola">
    
    <div id="gameModal" class="modal">
      <div class="modal-content">
        <div id="startScreen" class="startScreen">
            <h2 class="modal-title">READY TO PLAY?</h2>
            <div class="start-panel">
              <button id="modalStartButton" class="pulsante">START</button> <!-- prima era start-btn--big -->
              <p class="small-note">
                Press the HIT button or the spacebar on time to play the rhythm. <br>
                  Rules:<br>
                  - You have 3 lives ❤️❤️❤️<br>
                  - You lost one life at every wrong measure<br>
                  - No more live -> Game Over <br>
              </p>
            </div>
        </div>
        <div id="gameOverScreen" class="hidden">
          <h2 class="modal-title game-over-title">GAME OVER!</h2>
            <p class="modal-description">Your final rhythm level was:</p>
            <p id="finalScore" class="final-score-text">Round 1 @ 60 BPM</p>

            <div id="namePanel" class="hidden" style="margin: 10px 0 18px;"> <!-- ANNA RIGUARDA STE COSE IN PX -->
              <p style="margin-bottom: 8px;">Enter your name to save your score:</p>
              <input id="playerNameInput" type="text" maxlength="24" placeholder="Your name" 
                style="padding:10px; border-radius:10px; border:1px solid #ccc; width: 80%; max-width: 260px; font:var(--font-family);">
             <div style="margin-top: 10px;">
              <button id="saveScoreBtn" class="pulsante pulsante--verde">SAVE SCORE</button>
            </div>
          <div id="nameResult" style="margin-top:10px; font-size:0.9rem;"></div>
        </div>

        
            <div class="modal-button-row">
              <button id="modalRestartButton" class="pulsante">PLAY AGAIN</button> 
              
              <a href="gameslist.html" class="sound-link">
                <button class="pulsante pulsante--back">BACK TO MENU</button>
              </a>
            </div>
        </div>
      </div>
    </div>
    
    <div class="game-frame">
    <h1 id="mainTitle" class="game-title">Follow the beat</h1>
    <p id="subTitle" class="game-subtitle">Training to keep on time the beat, increasing the BPM.</p>
    <div id="statusText" class="status-text">Press START to begin.</div>
  
    <div class="top-row">
      <div class="beat-panel">
        <div class="led-row">
          <div class="led" data-index="0"></div>
          <div class="led" data-index="1"></div>
          <div class="led" data-index="2"></div>
          <div class="led" data-index="3"></div>
        </div>
        <div class="notation-panel">
          <div class="notation-staff" id="notationStaff"></div>
        </div>
      </div>
    </div>
  
    
  
        <div class="single-btn-wrapper">
          <button id="hitButton" class="hit-btn-big">HIT</button>
        </div>
  
        <div class="life-display">
          <span id="lifeContainer"></span>
        </div>
  
        <div class="info-row">
          <span>BPM: <span id="bpmDisplay">60</span></span>
          <span>Round: <span id="roundDisplay">1</span></span>
          <span>Score: <span id="scoreDisplay">0</span></span>
        </div>
  </div>

    <script type="module" src="main.js"></script>

    <script type="module">
        import { AudioManager } from './GameSounds.js';

        window.addEventListener('load', () => {
            
            const audio = new AudioManager();
            audio.init(); 

            
            const unlockAudio = () => {
                if (!audio.ctx) audio.init();
                else if (audio.ctx.state === 'suspended') audio.ctx.resume();
            };

            // 1. GESTIONE DEI PULSANTI UI STANDARD (Start, Save, Restart)
           
            document.querySelectorAll('.pulsante').forEach(btn => {
               
                if(btn.closest('.sound-link')) return;

                btn.addEventListener('click', () => {
                    unlockAudio();
                    audio.playTouchUI();
                });
            });

            // 2. GESTIONE LINK DI NAVIGAZIONE (Back to Menu)
            const navLinks = document.querySelectorAll('.sound-link');

            navLinks.forEach(link => {
                link.addEventListener('click', (event) => {
                    
                    event.preventDefault();

                   
                    unlockAudio();
                    audio.playTouchUI();

                   
                    const targetUrl = link.getAttribute('href');

                    
                    setTimeout(() => {
                        window.location.href = targetUrl;
                    }, 300);
                });
            });
        });
    </script>
  </body>

</html>

